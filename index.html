<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // 1. ᴇxᴛʀᴀᴄᴛ ᴅᴀᴛᴀ ꜰʀᴏᴍ ᴜʀʟ
    const params = new URLSearchParams(window.location.search);
    const currentLang = params.get('lang') || 'python';
    
    // 2. ᴅᴇᴄᴏᴅᴇ ᴛʜᴇ ᴄᴏᴅᴇ (ᴛʜɪs is ᴛʜᴇ ɪᴍᴘᴏʀᴛᴀɴᴛ ᴘᴀʀᴛ!)
    let codeFromBot = params.get('code');
    if (codeFromBot) {
        codeFromBot = decodeURIComponent(codeFromBot);
    } else {
        codeFromBot = "// ɴᴏ ᴄᴏᴅᴇ ʀᴇᴄᴇɪᴠᴇᴅ. ᴘʟᴇᴀsᴇ sᴇɴᴅ ᴀ ᴘʀᴏᴍᴘᴛ ᴛᴏ ᴛʜᴇ ʙᴏᴛ.";
    }

    document.getElementById('lang-label').innerText = "ʟᴀɴɢᴜᴀɢᴇ: " + currentLang.toUpperCase();

    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' } });
    require(['vs/editor/editor.main'], function () {
        window.editor = monaco.editor.create(document.getElementById('editor-container'), {
            value: codeFromBot,
            language: currentLang,
            theme: 'vs-dark',
            automaticLayout: true,
            fontSize: 14,
            minimap: { enabled: false }
        });
    });

    function copyToClipboard() {
        const code = window.editor.getValue();
        navigator.clipboard.writeText(code).then(() => {
            tg.HapticFeedback.notificationOccurred('success');
            tg.showAlert("ᴄᴏᴅᴇ ᴄᴏᴘɪᴇᴅ ᴛᴏ ᴄʟɪᴘʙᴏᴀʀᴅ!");
        });
    }
</script>

